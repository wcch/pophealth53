<% content_for :head do %>
  <script type="text/javascript">
function llog(x) {window.console.log(x)}    
    
    var popHealth = popHealth || {};
    
    popHealth.drawPctChart = function(data) {
        var elem = "#mcp";
        var percent = data.denominator > 0 ? (data.numerator/data.denominator).toFixed(2)*100 : 0;
        var numeratorWidth = (data.numerator/<%= @patient_count %>).toFixed(2)*100;
        var denominatorWidth = data.denominator > 0 ? ((data.denominator - data.numerator)/<%= @patient_count %>).toFixed(2)*100 : 0;
        
        $(elem).find("#numeratorValue").text(data.numerator);
        $(elem).find("#denominatorValue").text(data.denominator);
        $(elem).find("#measurePopulationPercentage").text(percent + "%");
        
        $(elem).find(".barNumerator").css("width", numeratorWidth + "%");
        $(elem).find(".barDenominator").css("width", denominatorWidth + "%");

        $("#outcomeExclusionMarker").text(data.exceptions + " exclusion" + (data.exceptions = 1 ? "s":""));
        $("#eligibleCount").text(data.denominator);
        $("#outcomeCount").text(data.numerator);
    }
    
    
    popHealth.renderMeasureJSON = function(data) {
        var measure = data;
        $.getJSON("<%= measure_result_url(@definition['id'], @definition['sub_id']) %>",popHealth.drawPctChart);
        $("#measureTitleText").text(data.name);
        $("#measureDescText").text(data.description);
    }
    
    $(document).ready(function() {
    
    //$.getJSON("json/bp.json",popHealth.renderMeasureJSON);
    $.getJSON("<%= measure_definition_url(@definition['id'], @definition['sub_id']) %>",popHealth.renderMeasureJSON);
    
    $("#measurementPeriodEndDate").val(new Date().format("mm/dd/yyyy"));
    $("#btnSaveNewMeasure").click(popHealth.saveNewMeasure);
    $("#btnReturnToDash").click(popHealth.returnToDash);
    $("#measurementPeriodStartDate, #measurementPeriodEndDate").calendricalDate({usa:true});
    
});
  </script>

<% end %>

<div id="container">

    <%= render :partial => 'header', :locals => {:definition => @definition} %>
    
    <div id="pageContent">

        <%= render :partial => 'measure_title'%>

        <div id="measureEditContainer">
            <table id="patientTable">
                <tbody>
                    <% @anti_numerator.each do |patient| -%>
                        <tr class="antiNumerator">
                            <td><%= patient['first'] %></td>
                            <td><%= patient['last'] %></td>
                        </tr>
                    <% end -%>
                    <% @numerator.each do |patient| -%>
                        <tr class="numerator">
                            <td><%= patient['first'] %></td>
                            <td><%= patient['last'] %></td>
                        </tr>
                    <% end -%>
                </tbody>
            </table>
        </div><!-- end measureEditContainer -->
    </div><!-- end #pageContent -->

</div>